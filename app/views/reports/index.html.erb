<div class="row">
  <div class="col-sm-6"><h1>Reports <% if params[:format] %> <span class="label label-default"><%= params[:format].titleize %></span><% end %></h1></div>
  <div class="col-sm-6">
    <%= link_to 'Add report', new_report_path, class: 'btn btn-success pull-right', style: 'margin-top: 28px;' %>
  </div>
</div>

<div class="row">
  <div class="col-sm-4">
    <%= link_to 'New', reports_path(params: { format: :new }), class: "label label-primary" %>
    <%= link_to 'In Process', reports_path(params:  { format: :in_process }), class: "label label-primary" %>
    <%= link_to 'Finished', reports_path(params: { format: :finished }), class: "label label-primary" %>
    <%= link_to 'All', reports_path(params: { format: :all }), class: "label label-default" %>
  </div>
</div>

<table class="table">
  <thead>
  <tr>
    <th><%= sortable :format, 'Format' %></th>
    <th>Usernames file</th>
    <th>Status</th>
    <th>Progress</th>
    <th>Created</th>
    <th>Started</th>
    <th>Finished</th>
    <th>Result file</th>
  </tr>
  </thead>
  <tbody>
  <% @reports.each do |report| %>
    <tr>
      <td><%= report.format %> for <%= report.usernames.size %> usernames</td>
      <td><%= link_to "Download usernames", "#{root_url}/#{report.input_data}", target: :_blank %></td>
      <td><span class="label label-<%= {'new' => 'info', 'in_process' => 'primary', 'finished' => 'success'}[report.status] %>"><%= report.status.titleize %></span></td>
      <td>
        <div class="progress">
          <div class="progress-bar" role="progressbar" aria-valuenow="<%= report.progress || 0 %>" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em; width: <%= report.progress || 0 %>%;">
            <%= report.progress || 0 %>% Complete
          </div>
        </div>
      </td>
      <td><%= report.created_at.strftime('%m/%d/%y %H:%M:%S') %></td>
      <td><%= report.started_at.strftime('%m/%d/%y %H:%M:%S') if report.started_at %></td>
      <td><%= report.finished_at.strftime('%m/%d/%y %H:%M:%S') if report.finished_at %></td>
      <td><%= link_to 'Download report', report.result_data, target: :_blank if report.result_data.present? %></td>
    </tr>
  <% end %>
  </tbody>
</table>
<%= paginate @reports %>